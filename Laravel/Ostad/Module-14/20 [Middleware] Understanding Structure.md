### মিডলওয়্যার কী?

মিডলওয়্যার হলো একটি কোড বা ফাংশন, যা একটি **রিকোয়েস্ট (Request)** সার্ভারে পৌঁছানোর পরে এবং **রেসপন্স (Response)** তৈরি হওয়ার আগে এক্সিকিউট হয়। এটি রিকোয়েস্ট এবং রেসপন্সের মাঝে অবস্থান করে এবং উভয় ক্ষেত্রেই কিছু কার্যক্রম সম্পন্ন করতে পারে। উদাহরণস্বরূপ, মিডলওয়্যার রিকোয়েস্টের হেডার, বডি, প্যারামিটার, কুকি ইত্যাদি পরীক্ষা করতে পারে, এবং রেসপন্সের ক্ষেত্রেও এটি হেডার বা বডি ম্যানিপুলেট করতে পারে।

মিডলওয়্যারকে এক ধরনের **ফিল্টার** হিসেবে ভাবা যেতে পারে, যা রিকোয়েস্টের যাবতীয় তথ্য যাচাই করে এবং যদি প্রয়োজন হয় তবে এটি রেসপন্সে কিছু পরিবর্তন করে। এটি সাধারণত সিকিউরিটি, অথেনটিকেশন, বা রিকোয়েস্ট ভ্যালিডেশনের মতো কাজের জন্য ব্যবহৃত হয়।

### মিডলওয়্যার তৈরি করা

ল্যারাভেলে মিডলওয়্যার তৈরি করতে আমরা নিচের মতো করে `artisan` কমান্ড ব্যবহার করি:

```bash
php artisan make:middleware DemoMiddleware
```

এটি `DemoMiddleware` নামে একটি মিডলওয়্যার তৈরি করবে। তৈরি হওয়া মিডলওয়্যার ফাইলটিতে একটি ক্লাস থাকবে, যেখানে মিডলওয়্যারের মূল কার্যক্রম পরিচালিত হয়।

### মিডলওয়্যারের কাঠামো

নতুন মিডলওয়্যার তৈরি করার পর আপনি যে কোডটি পাবেন তা নিচের মতো হবে:

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class DemoMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return \Symfony\Component\HttpFoundation\Response
     */
    public function handle(Request $request, Closure $next): Response
    {
        return $next($request);
    }
}
```

#### handle() মেথড

`handle()` মেথডের কাজ হলো ইনকামিং রিকোয়েস্ট (Request) গ্রহণ করা এবং সেটিকে প্রসেস করা। এটি দুটি প্যারামিটার নেয়:

- **Request**: এটি রিকোয়েস্টের সমস্ত তথ্য ধারণ করে, যেমন হেডার, বডি, প্যারামিটার, কুকি ইত্যাদি।
- **Closure $next**: এটি মিডলওয়্যারের পরে কি ঘটবে তা নির্ধারণ করে। যদি রিকোয়েস্ট মিডলওয়্যারের সব নিয়ম পূরণ করে, তাহলে `$next($request)` কল করা হয়, যার মাধ্যমে রিকোয়েস্টটি কন্ট্রোলারে পাঠানো হয়।

### মিডলওয়্যার কীভাবে কাজ করে?

1. **রিকোয়েস্ট পাওয়া**: যখন একটি রিকোয়েস্ট আসে, প্রথমেই মিডলওয়্যার এক্সিকিউট হয়। মিডলওয়্যার রিকোয়েস্টের বিভিন্ন অংশ যেমন হেডার, বডি, কুকি পরীক্ষা করতে পারে।
   
2. **রেসপন্স পাঠানোর আগে**: মিডলওয়্যার শুধু রিকোয়েস্ট নিয়ে কাজ করে না, এটি রেসপন্সে কিছু পরিবর্তনও করতে পারে। উদাহরণস্বরূপ, রেসপন্সের হেডার পরিবর্তন করা বা কিছু অতিরিক্ত তথ্য যোগ করা।

### মিডলওয়্যারের ব্যবহার

মিডলওয়্যার সাধারণত সিকিউরিটি, অথেনটিকেশন এবং রিকোয়েস্ট ভ্যালিডেশনের মতো কাজের জন্য ব্যবহৃত হয়। উদাহরণস্বরূপ:

- **অথেনটিকেশন**: মিডলওয়্যার যাচাই করতে পারে যে, ব্যবহারকারী লগ ইন করা আছে কিনা।
- **রিকোয়েস্ট ভ্যালিডেশন**: রিকোয়েস্টে থাকা ডেটা সঠিক কিনা, মিডলওয়্যার সেটি পরীক্ষা করতে পারে।
- **রিকোয়েস্ট লিমিট**: মিডলওয়্যার ব্যবহার করে প্রতি মিনিটে কতগুলো রিকোয়েস্ট আসছে তা সীমাবদ্ধ করা যায়।
- **ফিল্টারিং**: মিডলওয়্যার ব্যবহার করে সন্দেহজনক রিকোয়েস্টগুলোকে ব্লক করা যায়।

### সহজ উদাহরণ

ধরি, আমরা একটি মিডলওয়্যার তৈরি করতে চাই, যা দেখে যে, রিকোয়েস্টের সাথে একটি নির্দিষ্ট হেডার আছে কিনা:

```php
public function handle(Request $request, Closure $next): Response
{
    if (!$request->hasHeader('X-Special-Header')) {
        return response('Unauthorized', 401);
    }

    return $next($request);
}
```

এই কোডে, আমরা যাচাই করছি যে, রিকোয়েস্টে `'X-Special-Header'` নামে একটি হেডার আছে কিনা। যদি না থাকে, তবে আমরা একটি ৪০১ (Unauthorized) রেসপন্স পাঠাচ্ছি, আর যদি থাকে, তবে আমরা রিকোয়েস্টটিকে কন্ট্রোলারের দিকে পাঠিয়ে দিচ্ছি।

### উপসংহার

মিডলওয়্যার একটি গুরুত্বপূর্ণ অংশ যা রিকোয়েস্ট ও রেসপন্সের মাঝে কাজ করে এবং সার্ভারে আসা রিকোয়েস্টগুলোকে ফিল্টার করতে, যাচাই করতে এবং ম্যানিপুলেট করতে সহায়তা করে। সঠিকভাবে মিডলওয়্যার ব্যবহার করে আমরা আমাদের অ্যাপ্লিকেশনকে আরো সুরক্ষিত ও কার্যকর করতে পারি।